# A parser to handle boolean expressions including mathematical expressions and identifiers using TypeScript

## Introduction
I was looking for a way to use boolean expressions including mathematical expressions and identifiers using TypeScript.
After some searching I ended up using ANTLR4 and the ANTLR4ts and ANTLR4ts-cli tools.

These can be easily installed using  `npm install` using the `package.json` in this project.

## Installation
This project uses `npm` to install all the dependencies. Make sure that ANTLR is installed on your
platform. 

The problem is that ANTLR4/typescript module does not work with Typescript 4.6.4. So I recompiled 
the Java files used by the `antlr4ts-cli`-script. These can be found in the folder 
`ANTLR4/java-recompiled-typescript4.4.4`. 

* Copy the file `antlr4-typescript-4.9.0-SNAPSHOT-complete.jar` to the destination folder 
 `node_modules/antlr4ts-cli/target`
* Run the script `antlr4ts -visitor BooleanMath.g4 -o ../src/app/classes/parser/ANTLR4` or use the Bash Shell script
 `generateG4DependantFiles.sh` from the folder `ANTLR4`.


# Recompiling the ANTLR4ts-cli for new Typescript version
You might wonder why you would want to create a new `ANTRL4ts-cli`. Well, sometimes the newest 
Typescript versions might impose new rules, often meaning it is more restrictive. This has the 
effect that the code generated by `ANTRL4ts-cli` will not compile.

Solution is to create a new version of the `.jar`-file that is used to generate these files. 

## Prerequisites
* A java Software Development Kit (JDK) must be installed. 

Steps to recompile
* Clone the sources from the [ANTLR4 website](https://github.com/tunnelvisionlabs/antlr4ts.git).
* Open the project in an IDE that can compile Java-projects (Eclipse, Intellij).
* Open the file `./tool/resources/org/antlr/v4/tool/templates/codegen/TypeScript/TypeScript.stg`
* Make the proper modifications in order to comply with the newest Typescript
* Open a terminal / DOS-box / Powershell session
* navigate to the folder `./tool` (relative to the project root-folder)
* run `npm install`
* use a filemanager to pickup the file `tool/target/antlr4-typescript-4.9.0-SNAPSHOT-complete.jar`
and place it in the `ANTRL4ts-cli` folder (see section 'Installation' in this readme).

# Usage
In the script below a simple expression is parsed and evaluated using one `identifier` named `x`.

The first step is create a wrapper class that will take care of taking an expression, running it
through lexers and parsers to see if it contains errors.

If there are no errors, then the parser is ready to process the expression using a given list
of identifiers.

This example is also present in the file `src/app.ts`.  

```javascript
import {TriggerDataParser} from "./app/classes/parser/TriggerDataParser";

const identifiers = new Map<string, any>();
identifiers.set('x', 2);

const parser = new TriggerDataParser();
const resultProcessingExpression = parser.processExpression('true and (1+1 == x)');
if (resultProcessingExpression) {
  const result = parser.processUsingData(identifiers);
  console.log(result);
}
```

## Running the example
From a terminal / DOS box / Powershell run the Typescript compiler:

`ts-node-dev --respawn --transpile-only ./src/app.ts`

To compile (to Javascript runnable in `nodejs`) use 

`tsc --project tsconfig.json` 

and look for the results in folder `dist/out`.

# Expanding the language
If you would like to expand the language then follow the steps below:
* edit the file `ANTLR4/BooleanMath.g4` and `ANTLR4/BooleanMathLex.g4`
* run the script to generate the files to the proper location: `ANTLR4/generateG4DependantFiles.sh` 
 from a terminal. This will ultimately run this command:  `antlr4ts -visitor BooleanMath.g4 -o ../src/app/classes/parser/ANTLR4`
* this will generate new files in `src/app/classes/parser/ANTLR4`. In the file `BooleanMathVisitor` new or adapted methods
will be generated. These must be implemented in the visitor `src/app/classes/parser/MyTriggerVisitor.ts`.
 
## Recommendations
I highly recommend to install a G4-parser extension in your IDE to test the new language! See the 
references below. 

## Generating Documentation
I really like to visualise the language I created. One way to visualise a language is using 
*railroad maps* or [syntax diagrams](https://en.wikipedia.org/wiki/Syntax_diagram)). Because ANTLR4
uses (loosely) the BNF notation this should be "easy"....

For this I found a [github repository](https://github.com/bkiers/rrd-antlr4) from
[Bart Kiers](https://github.com/bkiers). 

The compiled version is in the `documentation` folder. Use it like this:
```shell
java -jar rrd-antlr4-0.1.2.jar BooleanMath.g4
```


# References
* [ANTLR4](https://www.antlr.org/)
* [ANTLR4ts-cli sources](https://github.com/tunnelvisionlabs/antlr4ts.git)
* [ANTLR4 IDE Extensions](https://www.antlr.org/tools.html)
* [Jetbrains ANTLR4 extension](https://plugins.jetbrains.com/plugin/7358-antlr-v4/)